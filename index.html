<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compressor Payment Management System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f5f7fa; color: #333; padding: 20px; }
    .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; }
    header { background: linear-gradient(135deg, #2c3e50, #4a6491); color: white; padding: 25px; text-align: center; }
    header h1 { font-size: 28px; margin-bottom: 5px; }
    .tabs { display: flex; border-bottom: 1px solid #ddd; }
    .tab { padding: 15px 25px; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; }
    .tab.active { color: #4a6491; border-bottom: 3px solid #4a6491; }
    .main-content { display: flex; flex-wrap: wrap; }
    .sidebar { flex: 0 0 350px; background: #f9f9f9; padding: 25px; border-right: 1px solid #eee; }
    .content-area { flex: 1; padding: 25px; }
    .section-title { font-size: 20px; color: #2c3e50; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #4a6491; display: flex; align-items: center; }
    .section-title i { margin-right: 10px; color: #4a6491; }

    /* Calendar Styles */
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin: 20px 0; }
    .calendar-header { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: bold; padding: 10px 0; background: #4a6491; color: white; border-radius: 8px; }
    .day-name { padding: 10px; }
    .date-box {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f0f8ff;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .date-box:hover { background: #e0f0ff; border-color: #4a6491; }
    .date-box.selected { background: #4a6491; color: white; border-color: #2c3e50; }
    .date-box.today { border: 3px solid #28a745; font-weight: bold; }

    /* Daily Entry Table */
    .daily-entry-row { display: grid; grid-template-columns: 3fr 2fr 1fr 1fr 1fr 1.5fr 1fr; gap: 10px; margin-bottom: 10px; align-items: center; }
    .daily-entry-row.header { font-weight: bold; background: #4a6491; color: white; padding: 12px; border-radius: 8px; }
    .daily-entry-row input, .daily-entry-row select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    .totals-row { font-weight: bold; background: #e8f4ff; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 18px; }

    .btn { padding: 12px 20px; background: #4a6491; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; }
    .btn:hover { background: #2c3e50; }
    .btn-success { background: #28a745; }
    .btn-success:hover { background: #1e7e34; }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th { background: #4a6491; color: white; padding: 15px; text-align: left; }
    td { padding: 15px; border-bottom: 1px solid #eee; }
    tr:hover { background: #f1f5fd; }

    @media (max-width: 992px) {
      .main-content { flex-direction: column; }
      .sidebar { border-right: none; border-bottom: 1px solid #eee; }
      .daily-entry-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-file-invoice-dollar"></i> Compressor Payment Management System</h1>
      <p>Daily drilling records with calendar entry • December 2025</p>
    </header>

    <div class="tabs">
      <div class="tab active" data-tab="daily">Daily Entry (Calendar)</div>
      <div class="tab" data-tab="data">All Compressors</div>
      <div class="tab" data-tab="summary">Summary Report</div>
    </div>

    <div class="main-content">
      <div class="sidebar">
        <!-- Daily Entry Tab -->
        <div class="tab-content active" id="daily">
          <h2 class="section-title"><i class="fas fa-calendar-alt"></i> December 2025 - Daily Entry</h2>
          <div class="calendar-header">
            <div class="day-name">Sun</div>
            <div class="day-name">Mon</div>
            <div class="day-name">Tue</div>
            <div class="day-name">Wed</div>
            <div class="day-name">Thu</div>
            <div class="day-name">Fri</div>
            <div class="day-name">Sat</div>
          </div>
          <div class="calendar" id="calendar-grid"></div>

          <div id="daily-entry-form" style="display:none; margin-top: 30px;">
            <h3 class="section-title"><i class="fas fa-edit"></i> Enter Data for <span id="selected-date-display"></span></h3>
            <label><strong>How many compressors worked on this day?</strong></label>
            <input type="number" id="compressor-count" min="1" placeholder="e.g. 8" style="width:100%; padding:12px; margin:15px 0; font-size:16px;">
            <button class="btn btn-success" id="generate-rows">Generate Rows</button>

            <div id="daily-rows-container" style="margin-top: 20px;"></div>

            <div id="daily-totals" class="totals-row" style="display:none;">
              Total Holes: <span id="total-holes">0</span> |
              Total Feet: <span id="total-feet">0.00</span> |
              Total Amount: <span id="total-amount">₹ 0.00</span>
            </div>

            <button class="btn btn-success" id="save-daily-bills" style="width:100%; margin-top:20px; padding:15px;">
              <i class="fas fa-save"></i> Save All Entries for This Day
            </button>
          </div>
        </div>

        <!-- Other sidebar tabs (All Compressors, Summary) remain similar -->
        <div class="tab-content" id="data"> <!-- Same as before --> </div>
        <div class="tab-content" id="summary"> <!-- Same as before --> </div>
      </div>

      <div class="content-area">
        <div class="tab-content active" id="entry-table">
          <h2 class="section-title"><i class="fas fa-table"></i> Instructions</h2>
          <p>Click any date box in December calendar → Enter number of compressors → Fill details → Save.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const compressorData = [ /* Your full compressorData array from before - keep it exactly the same */ 
      { id: 1, name: "ALLAM VASU", tractors: ["AP39CA2814"], bankAccount: "40988132071", ifsc: "SBIN0000805", pan: "CVOPV6966K", bills: [] },
      { id: 2, name: "POLINATI VENKATA SRINIVASA RAO", tractors: ["AP35 V 5237", "AP07AG 6505"], bankAccount: "6086101003124", ifsc: "CNRB0006086", pan: "ENNPP6015C", bills: [] },
      // ... all 37 entries (keep unchanged)
      { id: 37, name: "OMMI MODI BABU", tractors: [], bankAccount: "6086101003133", ifsc: "CNRB0006086", pan: "ABEP01294K", bills: [] }
    ];

    let selectedDate = null;
    let dailyEntries = [];

    // Generate December 2025 Calendar
    function generateCalendar() {
      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '';
      const firstDay = new Date(2025, 11, 1).getDay(); // Dec 1, 2025 is Monday (1)
      const daysInMonth = 31;

      // Empty boxes before Dec 1
      for (let i = 0; i < firstDay; i++) {
        grid.innerHTML += '<div></div>';
      }

      const today = new Date();
      const isToday = (d) => today.getFullYear() === 2025 && today.getMonth() === 11 && today.getDate() === d;

      for (let day = 1; day <= daysInMonth; day++) {
        const box = document.createElement('div');
        box.className = 'date-box';
        if (isToday(day)) box.classList.add('today');
        box.textContent = day;
        box.onclick = () => selectDate(day);
        grid.appendChild(box);
      }
    }

    function selectDate(day) {
      document.querySelectorAll('.date-box').forEach(b => b.classList.remove('selected'));
      event.target.classList.add('selected');
      selectedDate = `2025-12-${day.toString().padStart(2, '0')}`;
      document.getElementById('selected-date-display').textContent = `${day}/12/2025`;
      document.getElementById('daily-entry-form').style.display = 'block';
      dailyEntries = [];
      document.getElementById('daily-rows-container').innerHTML = '';
      document.getElementById('daily-totals').style.display = 'none';
      document.getElementById('compressor-count').value = '';
    }

    document.getElementById('generate-rows').onclick = () => {
      const count = parseInt(document.getElementById('compressor-count').value);
      if (!count || count < 1) return alert("Enter a valid number of compressors");

      const container = document.getElementById('daily-rows-container');
      container.innerHTML = `
        <div class="daily-entry-row header">
          <div>Compressor Name</div>
          <div>Tractor Number</div>
          <div>Holes</div>
          <div>Depth (Feet)</div>
          <div>Rate (₹)</div>
          <div>Amount (₹)</div>
          <div>Action</div>
        </div>
      `;

      dailyEntries = [];

      for (let i = 0; i < count; i++) {
        const row = document.createElement('div');
        row.className = 'daily-entry-row';
        row.innerHTML = `
          <select class="compressor-select" data-index="${i}">
            <option value="">-- Select Compressor --</option>
            ${compressorData.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
          </select>
          <select class="tractor-select" data-index="${i}" disabled>
            <option value="">-- First select compressor --</option>
          </select>
          <input type="number" class="holes-input" data-index="${i}" min="0" placeholder="0">
          <input type="number" class="feet-input" data-index="${i}" min="0" step="0.01" placeholder="0.00">
          <input type="number" class="rate-input" value="30.75" readonly>
          <input type="text" class="amount-display" value="₹ 0.00" readonly style="font-weight:bold;">
          <button class="btn btn-danger" onclick="removeRow(this)">Remove</button>
        `;
        container.appendChild(row);

        dailyEntries.push({
          compressorId: null,
          tractor: "",
          holes: 0,
          feet: 0,
          rate: 30.75,
          amount: 0
        });
      }

      // Event listeners
      document.querySelectorAll('.compressor-select').forEach(sel => {
        sel.onchange = function() {
          const index = this.dataset.index;
          const compId = parseInt(this.value);
          const tractorSelect = document.querySelector(`.tractor-select[data-index="${index}"]`);
          const comp = compressorData.find(c => c.id === compId);

          tractorSelect.innerHTML = '<option value="">-- Select Tractor --</option>';
          if (comp && comp.tractors.length > 0) {
            comp.tractors.forEach(t => {
              const opt = document.createElement('option');
              opt.value = t;
              opt.textContent = t;
              tractorSelect.appendChild(opt);
            });
            tractorSelect.disabled = false;
          } else {
            tractorSelect.disabled = true;
          }

          dailyEntries[index].compressorId = compId;
          updateRowTotal(index);
        };
      });

      document.querySelectorAll('.holes-input, .feet-input').forEach(input => {
        input.oninput = () => updateRowTotal(input.dataset.index);
      });

      document.querySelectorAll('.tractor-select').forEach(sel => {
        sel.onchange = function() {
          const index = this.dataset.index;
          dailyEntries[index].tractor = this.value;
        };
      });
    };

    function updateRowTotal(index) {
      const holes = parseFloat(document.querySelectorAll('.holes-input')[index].value) || 0;
      const feet = parseFloat(document.querySelectorAll('.feet-input')[index].value) || 0;
      const rate = 30.75;
      const amount = feet * rate;

      dailyEntries[index].holes = holes;
      dailyEntries[index].feet = feet;
      dailyEntries[index].amount = amount;

      document.querySelectorAll('.amount-display')[index].value = `₹ ${amount.toFixed(2)}`;

      updateDailyTotals();
    }

    function updateDailyTotals() {
      const totalH = dailyEntries.reduce((s, e) => s + e.holes, 0);
      const totalF = dailyEntries.reduce((s, e) => s + e.feet, 0);
      const totalA = dailyEntries.reduce((s, e) => s + e.amount, 0);

      document.getElementById('total-holes').textContent = totalH;
      document.getElementById('total-feet').textContent = totalF.toFixed(2);
      document.getElementById('total-amount').textContent = `₹ ${totalA.toFixed(2)}`;
      document.getElementById('daily-totals').style.display = 'block';
    }

    window.removeRow = function(btn) {
      const row = btn.parentElement;
      const index = Array.from(row.parentElement.children).indexOf(row) - 1; // -1 for header
      row.remove();
      dailyEntries.splice(index, 1);
      updateDailyTotals();
    };

    document.getElementById('save-daily-bills').onclick = () => {
      if (dailyEntries.length === 0) return alert("No entries to save");

      const formattedDate = selectedDate.split('-').reverse().join('/');
      
      dailyEntries.forEach(entry => {
        if (!entry.compressorId) return;

        const compressor = compressorData.find(c => c.id === entry.compressorId);
        if (compressor) {
          compressor.bills.push({
            id: Date.now() + Math.random(),
            date: selectedDate,
            formattedDate: formattedDate,
            shift: "Full Day", // You can add shift later
            companyName: "Daily Work", // You can enhance this
            branch: "",
            tractor: entry.tractor || "Not specified",
            holes: entry.holes,
            feet: entry.feet,
            rate: entry.rate,
            totalAmount: entry.amount
          });
        }
      });

      saveDataToStorage();
      alert(`Saved ${dailyEntries.filter(e => e.compressorId).length} entries for ${formattedDate}!`);
      document.getElementById('daily-entry-form').style.display = 'none';
    };

    // Storage & Init functions (keep your existing ones)
    function saveDataToStorage() {
      const toSave = compressorData.map(c => ({ id: c.id, bills: c.bills }));
      localStorage.setItem('compressorBills', JSON.stringify(toSave));
    }

    function loadDataFromStorage() {
      const stored = localStorage.getItem('compressorBills');
      if (stored) {
        const parsed = JSON.parse(stored);
        parsed.forEach(item => {
          const comp = compressorData.find(c => c.id === item.id);
          if (comp) comp.bills = item.bills || [];
        });
      }
    }

    // Tab switching (simplified)
    document.querySelectorAll('.tab').forEach(tab => {
      tab.onclick = () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
      };
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      generateCalendar();
      loadDataFromStorage();
      // Keep your other init code if needed
    });
  </script>
</body>
</html>
